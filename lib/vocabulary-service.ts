// Serviço para gerenciar vocabulário e identificar palavras difíceis

// Lista simplificada de palavras comuns em inglês
const commonWords = new Set([
  "the",
  "be",
  "to",
  "of",
  "and",
  "a",
  "in",
  "that",
  "have",
  "I",
  "it",
  "for",
  "not",
  "on",
  "with",
  "he",
  "as",
  "you",
  "do",
  "at",
  "this",
  "but",
  "his",
  "by",
  "from",
  "they",
  "we",
  "say",
  "her",
  "she",
  "or",
  "an",
  "will",
  "my",
  "one",
  "all",
  "would",
  "there",
  "their",
  "what",
  "so",
  "up",
  "out",
  "if",
  "about",
  "who",
  "get",
  "which",
  "go",
  "me",
  "when",
  "make",
  "can",
  "like",
  "time",
  "no",
  "just",
  "him",
  "know",
  "take",
  "people",
  "into",
  "year",
  "your",
  "good",
  "some",
  "could",
  "them",
  "see",
  "other",
  "than",
  "then",
  "now",
  "look",
  "only",
  "come",
  "its",
  "over",
  "think",
  "also",
  "back",
  "after",
  "use",
  "two",
  "how",
  "our",
  "work",
  "first",
  "well",
  "way",
  "even",
  "new",
  "want",
  "because",
  "any",
  "these",
  "give",
  "day",
  "most",
  "us",
  "is",
  "are",
  "was",
  "were",
  "has",
  "had",
  "does",
  "did",
  "been",
  "being",
  "am",
])

// Lista simplificada de palavras intermediárias em inglês
const intermediateWords = new Set([
  "ability",
  "abroad",
  "absence",
  "absolute",
  "academic",
  "accept",
  "access",
  "accident",
  "accompany",
  "accomplish",
  "according",
  "account",
  "accurate",
  "achieve",
  "acknowledge",
  "acquire",
  "across",
  "action",
  "active",
  "activity",
  "actual",
  "adapt",
  "add",
  "address",
  "adequate",
  "adjust",
  "administration",
  "admit",
  "adopt",
  "advance",
  "advantage",
  "advice",
  "advise",
  "affair",
  "affect",
  "afford",
  "afraid",
  "afternoon",
  "again",
  "against",
  "age",
  "agency",
  "agenda",
  "agent",
  "aggressive",
  "ago",
  "agree",
  "agreement",
  "ahead",
  "aid",
  "aim",
  "air",
  "aircraft",
  "airline",
  "airport",
  "alarm",
  "alcohol",
  "alive",
  "alliance",
  "allow",
  "ally",
  "almost",
  "alone",
  "along",
  "already",
  "alter",
  "alternative",
  "although",
  "always",
  "amazing",
  "ambition",
  "ambitious",
  "among",
  "amount",
  "analysis",
  "analyst",
  "analyze",
  "ancient",
  "anger",
  "angle",
  "angry",
  "animal",
  "anniversary",
  "announce",
  "annual",
  "another",
  "answer",
  "anticipate",
  "anxiety",
  "any",
  "anybody",
  "anymore",
  "anyone",
  "anything",
  "anyway",
  "anywhere",
  "apart",
  "apartment",
  "apologize",
  "apology",
  "apparent",
  "appeal",
  "appear",
  "appearance",
  "apple",
  "application",
  "apply",
  "appoint",
  "appointment",
  "appreciate",
  "approach",
  "appropriate",
  "approval",
  "approve",
  "approximately",
  "architect",
  "area",
  "argue",
  "argument",
  "arise",
  "arm",
  "army",
  "around",
  "arrange",
  "arrangement",
  "arrest",
  "arrival",
  "arrive",
  "article",
  "artificial",
  "artist",
  "artistic",
  "aside",
  "ask",
  "asleep",
  "aspect",
  "assault",
  "assert",
  "assess",
  "assessment",
  "asset",
  "assign",
  "assignment",
  "assist",
  "assistance",
  "assistant",
  "associate",
  "association",
  "assume",
  "assumption",
  "assure",
  "athlete",
  "athletic",
  "atmosphere",
  "attach",
  "attack",
  "attempt",
  "attend",
  "attention",
  "attitude",
  "attorney",
  "attract",
  "attractive",
  "attribute",
  "audience",
  "author",
  "authority",
  "authorize",
  "automatic",
  "available",
  "average",
  "avoid",
  "award",
  "aware",
  "awareness",
  "away",
  "awful",

  "baby",
  "background",
  "balance",
  "ball",
  "band",
  "bank",
  "bar",
  "barely",
  "barrel",
  "barrier",
  "base",
  "baseball",
  "basic",
  "basically",
  "basis",
  "basket",
  "basketball",
  "bathroom",
  "battery",
  "battle",
  "beach",
  "bean",
  "bear",
  "beat",
  "beautiful",
  "beauty",
  "because",
  "become",
  "bedroom",
  "before",
  "begin",
  "beginning",
  "behavior",
  "behind",
  "being",
  "belief",
  "believe",
  "bell",
  "belong",
  "below",
  "belt",
  "bench",
  "bend",
  "beneath",
  "benefit",
  "beside",
  "besides",
  "best",
  "better",
  "between",
  "beyond",
  "bicycle",
  "bid",
  "big",
  "bike",
  "bill",
  "billion",
  "bind",
  "biology",
  "bird",
  "birth",
  "birthday",
  "bit",
  "bite",
  "black",
  "blade",
  "blame",
  "blanket",
  "blind",
  "block",
  "blood",
  "blow",
  "blue",
  "board",
  "boat",
  "body",
  "bomb",
  "bombing",
  "bond",
  "bone",
  "bonus",
  "book",
  "boom",
  "boot",
  "border",
  "born",
  "borrow",
  "boss",
  "both",
  "bother",
  "bottle",
  "bottom",
  "boundary",
  "bowl",
  "box",
  "boy",
  "boyfriend",
  "brain",
  "branch",
  "brand",
  "bread",
  "break",
  "breakfast",
  "breast",
  "breath",
  "breathe",
  "brick",
  "bridge",
  "brief",
  "briefly",
  "bright",
  "brilliant",
  "bring",
  "British",
  "broad",
  "broken",
  "brother",
  "brown",
  "brush",
  "buck",
  "budget",
  "build",
  "building",
  "bullet",
  "bunch",
  "burden",
  "burn",
  "bury",
  "bus",
  "business",
  "busy",
  "butter",
  "button",
  "buy",
  "buyer",
])

// Lista simplificada de palavras avançadas em inglês
const advancedWords = new Set([
  "abate",
  "aberration",
  "abeyance",
  "abject",
  "abjure",
  "ablution",
  "abnegate",
  "abominate",
  "aboveboard",
  "abrade",
  "abrogate",
  "abscond",
  "abstemious",
  "abstention",
  "abstruse",
  "accede",
  "accentuate",
  "acclimate",
  "accolade",
  "accost",
  "accretion",
  "acerbic",
  "acme",
  "acquiesce",
  "acrimony",
  "acumen",
  "adamant",
  "admonish",
  "adroit",
  "adulation",
  "adumbrate",
  "advent",
  "adventitious",
  "adversity",
  "aegis",
  "aesthetic",
  "affable",
  "affinity",
  "affluent",
  "aggrandize",
  "aggrieve",
  "agnostic",
  "alacrity",
  "alchemy",
  "alcove",
  "allay",
  "allege",
  "alleviate",
  "alliteration",
  "allusion",
  "aloof",
  "altercation",
  "altruism",
  "amalgamate",
  "ambiguity",
  "ambivalence",
  "ameliorate",
  "amenable",
  "amenity",
  "amiable",
  "amicable",
  "amity",
  "amnesty",
  "amorphous",
  "anachronism",
  "analogous",
  "anarchy",
  "anathema",
  "ancillary",
  "anecdote",
  "anemic",
  "animosity",
  "annex",
  "annihilate",
  "annotate",
  "anomaly",
  "antedate",
  "antediluvian",
  "anterior",
  "anthology",
  "anthropology",
  "antipathy",
  "antiquated",
  "antithesis",
  "apathy",
  "aperture",
  "apex",
  "aphasia",
  "aphorism",
  "apocalypse",
  "apocryphal",
  "apogee",
  "apoplectic",
  "apostasy",
  "apotheosis",
  "appease",
  "appellation",
  "apportion",
  "apposite",
  "apprehension",
  "approbation",
  "appropriate",
  "appurtenance",
  "aquiline",
  "arbitrary",
  "arcane",
  "archaic",
  "archetype",
  "archipelago",
  "ardent",
  "arduous",
  "argot",
  "arrant",
  "arrogance",
  "articulate",
  "artifice",
  "ascendancy",
  "ascetic",
  "asperity",
  "aspersion",
  "assiduous",
  "assuage",
  "astringent",
  "astute",
  "atavism",
  "atrophy",
  "attenuate",
  "audacious",
  "augment",
  "augury",
  "auspicious",
  "austere",
  "autocratic",
  "autonomous",
  "avarice",
  "aver",
  "aversion",
  "avid",
  "avuncular",
  "axiom",
  "azure",
  "badinage",
  "baffle",
  "baleful",
  "balk",
  "ballast",
  "banal",
  "bane",
  "barren",
  "bastion",
  "beatify",
  "bedlam",
  "befuddle",
  "beguile",
  "behemoth",
  "beleaguer",
  "belie",
  "bellicose",
  "belligerent",
  "bemoan",
  "bemused",
  "benediction",
  "benefactor",
  "benevolent",
  "benign",
  "bequeath",
  "berate",
  "bereft",
  "beseech",
  "besmirch",
  "bestial",
  "betoken",
  "bifurcate",
  "bilious",
  "blandishment",
  "blatant",
  "bleak",
  "blight",
  "blithe",
  "bombastic",
  "boorish",
  "bourgeois",
  "brackish",
  "brazen",
  "breach",
  "brevity",
  "brim",
  "brindled",
  "bristle",
  "brittle",
  "broach",
  "bromide",
  "brook",
  "bucolic",
  "buffet",
  "bulwark",
  "bumptious",
  "burgeon",
  "burlesque",
  "burnish",
  "buttress",
  "byzantine",
  "cacophony",
  "cadence",
  "cajole",
  "callow",
  "calumny",
  "candor",
  "canvass",
  "capitulate",
  "capricious",
  "captious",
  "cardinal",
  "carnal",
  "carnage",
  "carping",
  "cartography",
  "cascade",
  "caste",
  "castigate",
  "catalyst",
  "catastrophe",
  "categorical",
  "catharsis",
  "caustic",
  "caveat",
  "cavil",
  "celerity",
  "censorious",
  "censure",
  "cerebral",
  "chagrin",
  "chalice",
  "chameleon",
  "champion",
  "charisma",
  "charlatan",
  "chary",
  "chastise",
  "chimerical",
  "choleric",
  "churlish",
  "circuitous",
  "circumlocution",
  "circumscribe",
  "circumspect",
  "circumvent",
  "clairvoyant",
  "clamor",
  "clandestine",
  "clemency",
  "cloister",
  "coagulate",
  "coalesce",
  "coda",
  "codify",
  "coerce",
  "cogent",
  "cognizant",
  "colloquial",
  "collusion",
  "colossal",
  "comatose",
  "combustible",
  "comely",
  "comestible",
  "commensurate",
  "commiserate",
  "commodious",
  "communal",
  "compendium",
  "complacent",
  "complaisant",
  "complement",
  "compliant",
  "complicity",
  "compunction",
  "concave",
  "conciliatory",
  "concord",
  "concoct",
  "concupiscence",
  "condign",
  "condole",
  "condone",
  "confection",
  "confidant",
  "conflagration",
  "confluence",
  "confound",
  "congeal",
  "congenial",
  "congenital",
  "conglomerate",
  "congruent",
  "conjecture",
  "conjoin",
  "connive",
  "connubial",
  "consanguinity",
  "conscript",
  "consecrate",
  "consensus",
  "consign",
  "consonant",
  "consort",
  "conspicuous",
  "construe",
  "consummate",
  "contention",
  "contentious",
  "contiguous",
  "contrite",
  "contumacious",
  "conundrum",
  "convene",
  "convention",
  "convivial",
  "convoke",
  "copious",
  "coquette",
  "cornucopia",
  "corollary",
  "corporeal",
  "correlate",
  "corroborate",
  "corrosive",
  "cosmopolitan",
  "countenance",
  "countermand",
  "countervail",
  "covert",
  "covetous",
  "cozen",
  "craven",
  "credence",
  "credulous",
  "crepuscular",
  "crescendo",
  "crestfallen",
  "cryptic",
  "crystalline",
  "culmination",
  "culpable",
  "cumbersome",
  "cupidity",
  "curmudgeon",
  "cursory",
  "curtail",
  "cynosure",
])

/**
 * Verifica o nível de dificuldade de uma palavra em inglês
 * @param word A palavra a ser verificada
 * @returns O nível de dificuldade (1: fácil, 2: intermediário, 3: avançado, 0: desconhecido)
 */
export function getWordDifficulty(word: string): number {
  // Normaliza a palavra para minúsculas e remove pontuação
  const normalizedWord = word.toLowerCase().replace(/[.,!?;:'"()]/g, "")

  if (commonWords.has(normalizedWord)) {
    return 1 // Fácil
  } else if (intermediateWords.has(normalizedWord)) {
    return 2 // Intermediário
  } else if (advancedWords.has(normalizedWord)) {
    return 3 // Avançado
  } else {
    return 0 // Desconhecido
  }
}

/**
 * Verifica se uma palavra deve ser destacada com base na dificuldade
 * @param word A palavra a ser verificada
 * @param minDifficulty O nível mínimo de dificuldade para destacar (2: intermediário e acima, 3: apenas avançado)
 * @returns Boolean indicando se a palavra deve ser destacada
 */
export function shouldHighlightWord(word: string, minDifficulty = 2): boolean {
  const difficulty = getWordDifficulty(word)
  return difficulty >= minDifficulty && difficulty > 0
}

/**
 * Analisa um texto e retorna as palavras difíceis encontradas
 * @param text O texto a ser analisado
 * @param minDifficulty O nível mínimo de dificuldade para considerar uma palavra difícil
 * @returns Array de palavras difíceis encontradas no texto
 */
export function findDifficultWords(text: string, minDifficulty = 2): string[] {
  const words = text.split(/\s+/)
  const difficultWords = words.filter((word) => {
    const cleanWord = word.replace(/[.,!?;:'"()]/g, "")
    return shouldHighlightWord(cleanWord, minDifficulty)
  })

  return [...new Set(difficultWords)] // Remove duplicatas
}

/**
 * Extrai palavras únicas de um texto
 * @param text O texto de onde extrair as palavras
 * @returns Array de palavras únicas
 */
export function extractUniqueWords(text: string): string[] {
  const words = text
    .toLowerCase()
    .split(/\s+/)
    .map((word) => word.replace(/[.,!?;:'"()]/g, ""))
    .filter((word) => word.length > 2) // Ignora palavras muito curtas

  return [...new Set(words)] // Remove duplicatas
}

/**
 * Extrai palavras de mensagens de chat e as classifica por dificuldade
 * @param messages Array de mensagens do chat
 * @returns Array de objetos com palavra e dificuldade
 */
export function extractVocabularyFromChat(messages: { content: string }[]): { word: string; difficulty: number }[] {
  // Extrai todas as palavras de todas as mensagens
  const allWords = messages.flatMap((msg) => extractUniqueWords(msg.content))

  // Remove duplicatas
  const uniqueWords = [...new Set(allWords)]

  // Obtém a dificuldade para cada palavra
  const wordsWithDifficulty = uniqueWords
    .map((word) => ({
      word: word.charAt(0).toUpperCase() + word.slice(1), // Capitaliza a primeira letra
      difficulty: getWordDifficulty(word),
    }))
    .filter((item) => item.difficulty > 0) // Filtra palavras desconhecidas

  // Ordena por dificuldade (mais difíceis primeiro)
  return wordsWithDifficulty.sort((a, b) => b.difficulty - a.difficulty)
}
